<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>57. Techniques</title>
<link href="stylesheet.css" type="text/css" rel="stylesheet" />
</head>
<body>
<div id="leanpub-toc">
<h2></h2>
<ol class="toc has-parts">
<ul class='toc has-parts'>
  <li>
    <ul>
      <li>
        <a href='chap00.html#leanpub-auto-introduction'>Introduction</a>
      </li>
      <li>
        <a href='chap01.html#leanpub-auto-legal-notices'>Legal Notices</a>
      </li>
    </ul>
  </li>
  <li>
    <a href='chap02.html#leanpub-auto-getting-started'><span class="section-number">I </span>Getting started</a>
    <ul>
      <li>
        <a href='chap03.html#leanpub-auto-installing-groovy'><span class="section-number">1. </span>Installing Groovy</a>
      </li>
      <li>
        <a href='chap04.html#leanpub-auto-your-first-lines-of-groovy'><span class="section-number">2. </span>Your first lines of Groovy</a>
      </li>
      <li>
        <a href='chap05.html#leanpub-auto-comments'><span class="section-number">3. </span>Comments</a>
      </li>
      <li>
        <a href='chap06.html#leanpub-auto-statements'><span class="section-number">4. </span>Statements</a>
      </li>
      <li>
        <a href='chap07.html#leanpub-auto-the-assert-statement'><span class="section-number">5. </span>The <code>assert</code> statement</a>
      </li>
      <li>
        <a href='chap08.html#leanpub-auto-reserved-words'><span class="section-number">6. </span>Reserved Words</a>
      </li>
      <li>
        <a href='chap09.html#leanpub-auto-packages'><span class="section-number">7. </span>Packages</a>
      </li>
    </ul>
  </li>
  <li>
    <a href='chap10.html#leanpub-auto-variables'><span class="section-number">II </span>Variables</a>
    <ul>
      <li>
        <a href='chap11.html#leanpub-auto-declaring-variables'><span class="section-number">8. </span>Declaring Variables</a>
      </li>
      <li>
        <a href='chap12.html#leanpub-auto-data-types'><span class="section-number">9. </span>Data Types</a>
      </li>
      <li>
        <a href='chap13.html#leanpub-auto-objects'><span class="section-number">10. </span>Objects</a>
      </li>
      <li>
        <a href='chap14.html#leanpub-auto-booleans'><span class="section-number">11. </span>Booleans</a>
      </li>
      <li>
        <a href='chap15.html#leanpub-auto-numbers'><span class="section-number">12. </span>Numbers</a>
      </li>
      <li>
        <a href='chap16.html#leanpub-auto-strings'><span class="section-number">13. </span>Strings</a>
      </li>
      <li>
        <a href='chap17.html#leanpub-auto-collections'><span class="section-number">14. </span>Collections</a>
      </li>
      <li>
        <a href='chap18.html#leanpub-auto-arrays'><span class="section-number">15. </span>Arrays</a>
      </li>
      <li>
        <a href='chap19.html#leanpub-auto-ranges'><span class="section-number">16. </span>Ranges</a>
      </li>
      <li>
        <a href='chap20.html#leanpub-auto-regular-expressions'><span class="section-number">17. </span>Regular Expressions</a>
      </li>
      <li>
        <a href='chap21.html#leanpub-auto-data-types-1'><span class="section-number">18. </span>Data types</a>
      </li>
    </ul>
  </li>
  <li>
    <a href='chap22.html#leanpub-auto-operators'><span class="section-number">III </span>Operators</a>
    <ul>
      <li>
        <a href='chap23.html#leanpub-auto-operators-1'><span class="section-number">19. </span>Operators</a>
      </li>
      <li>
        <a href='chap24.html#leanpub-auto-numeric-operators'><span class="section-number">20. </span>Numeric Operators</a>
      </li>
      <li>
        <a href='chap25.html#leanpub-auto-simple-assignment-operator'><span class="section-number">21. </span>Simple Assignment Operator</a>
      </li>
      <li>
        <a href='chap26.html#leanpub-auto-the-complement-operator'><span class="section-number">22. </span>The Complement Operator</a>
      </li>
      <li>
        <a href='chap27.html#leanpub-auto-equality-operators'><span class="section-number">23. </span>Equality Operators</a>
      </li>
      <li>
        <a href='chap28.html#leanpub-auto-arithmetic-operators'><span class="section-number">24. </span>Arithmetic operators</a>
      </li>
      <li>
        <a href='chap29.html#leanpub-auto-relational-operators'><span class="section-number">25. </span>Relational Operators</a>
      </li>
      <li>
        <a href='chap30.html#leanpub-auto-increment-and-decrement-operators'><span class="section-number">26. </span>Increment and Decrement Operators</a>
      </li>
      <li>
        <a href='chap31.html#leanpub-auto-conditional-operators'><span class="section-number">27. </span>Conditional Operators</a>
      </li>
      <li>
        <a href='chap32.html#leanpub-auto-bitwise-operators'><span class="section-number">28. </span>Bitwise Operators</a>
      </li>
      <li>
        <a href='chap33.html#leanpub-auto-compound-assignment-operators'><span class="section-number">29. </span>Compound Assignment Operators</a>
      </li>
      <li>
        <a href='chap34.html#leanpub-auto-string-operators-1'><span class="section-number">30. </span>String Operators</a>
      </li>
      <li>
        <a href='chap35.html#leanpub-auto-regular-expression-operators-1'><span class="section-number">31. </span>Regular Expression Operators</a>
      </li>
      <li>
        <a href='chap36.html#leanpub-auto-collection-operators-1'><span class="section-number">32. </span>Collection operators</a>
      </li>
      <li>
        <a href='chap37.html#leanpub-auto-object-operators-1'><span class="section-number">33. </span>Object Operators</a>
      </li>
    </ul>
  </li>
  <li>
    <a href='chap38.html#leanpub-auto-control-flow-statements'><span class="section-number">IV </span>Control Flow Statements</a>
    <ul>
      <li>
        <a href='chap39.html#leanpub-auto-introduction-1'><span class="section-number">34. </span>Introduction</a>
      </li>
      <li>
        <a href='chap40.html#leanpub-auto-blocks'><span class="section-number">35. </span>Blocks</a>
      </li>
      <li>
        <a href='chap41.html#leanpub-auto-the-if-statement'><span class="section-number">36. </span>The <code>if</code> Statement</a>
      </li>
      <li>
        <a href='chap42.html#leanpub-auto-the-switch-statement'><span class="section-number">37. </span>The <code>switch</code> Statement</a>
      </li>
      <li>
        <a href='chap43.html#leanpub-auto-the-for-loop'><span class="section-number">38. </span>The <code>for</code> Loop</a>
      </li>
      <li>
        <a href='chap44.html#leanpub-auto-the-while-loop'><span class="section-number">39. </span>The <code>while</code> loop</a>
      </li>
      <li>
        <a href='chap45.html#leanpub-auto-branching-statements'><span class="section-number">40. </span>Branching statements</a>
      </li>
    </ul>
  </li>
  <li>
    <a href='chap46.html#leanpub-auto-exceptions'><span class="section-number">V </span>Exceptions</a>
    <ul>
      <li>
        <a href='chap47.html#leanpub-auto-the-throwable-family'><span class="section-number">41. </span>The Throwable Family</a>
      </li>
      <li>
        <a href='chap48.html#leanpub-auto-common-exceptions'><span class="section-number">42. </span>Common Exceptions</a>
      </li>
      <li>
        <a href='chap49.html#leanpub-auto-anatomy-of-an-exception'><span class="section-number">43. </span>Anatomy of an Exception</a>
      </li>
      <li>
        <a href='chap50.html#leanpub-auto-try-catch-finally'><span class="section-number">44. </span>Try-Catch-Finally</a>
      </li>
      <li>
        <a href='chap51.html#leanpub-auto-how-much-should-we-try'><span class="section-number">45. </span>How Much Should We try?</a>
      </li>
      <li>
        <a href='chap52.html#leanpub-auto-causing-an-exception'><span class="section-number">46. </span>Causing an Exception</a>
      </li>
      <li>
        <a href='chap53.html#leanpub-auto-catching-errors'><span class="section-number">47. </span>Catching Errors</a>
      </li>
      <li>
        <a href='chap54.html#leanpub-auto-methods-and-exceptions'><span class="section-number">48. </span>Methods and Exceptions</a>
      </li>
    </ul>
  </li>
  <li>
    <a href='chap55.html#leanpub-auto-methods'><span class="section-number">VI </span>Methods</a>
    <ul>
      <li>
        <a href='chap56.html#leanpub-auto-the-basics'><span class="section-number">49. </span>The Basics</a>
      </li>
      <li>
        <a href='chap57.html#leanpub-auto-parameters'><span class="section-number">50. </span>Parameters</a>
      </li>
      <li>
        <a href='chap58.html#leanpub-auto-default-values-for-parameters'><span class="section-number">51. </span>Default Values for Parameters</a>
      </li>
      <li>
        <a href='chap59.html#leanpub-auto-named-arguments'><span class="section-number">52. </span>Named Arguments</a>
      </li>
      <li>
        <a href='chap60.html#leanpub-auto-variable-arguments-varargs'><span class="section-number">53. </span>Variable Arguments (Varargs)</a>
      </li>
      <li>
        <a href='chap61.html#leanpub-auto-return-value'><span class="section-number">54. </span>Return value</a>
      </li>
      <li>
        <a href='chap62.html#leanpub-auto-throwing-an-exception'><span class="section-number">55. </span>Throwing an exception</a>
      </li>
      <li>
        <a href='chap63.html#leanpub-auto-documenting-a-method'><span class="section-number">56. </span>Documenting a method</a>
      </li>
      <li>
        <a href='chap64.html#leanpub-auto-techniques'><span class="section-number">57. </span>Techniques</a>
      </li>
      <li>
        <a href='chap65.html#leanpub-auto-colophon'>Colophon</a>
      </li>
    </ul>
  </li>
</ul>

</ol>
</div>
<div id="leanpub-main">
<h2 id="leanpub-auto-techniques"><span class="section-number">57. </span>Techniques</h2>

<table class="information sidebarish">
  <tbody>
    <tr><td class="sidebar-icon">
      <img class="sidebar-image" src="images/leanpub_info-circle.png" alt="information" width="50px" /></td>
    <td>
      <p>Here are some ideas to help your method writing but not your method acting.</p>

    </td>
  </tr>
  </tbody>
</table><p>I’d like to tell you that your programming career will be all about writing perfect code that never has problems but I’d just be lying. Here are some techniques to help make sure your methods are more robust and helpful to other programmers.</p>

<h3 id="leanpub-auto-valid-parameters">Valid parameters</h3>

<p>We understand that the method <code>determineAverage(...values)</code> is expecting a list of numbers and have used a reasonably clear naming strategy (<code>determineAverage</code>) to display that the method is number-oriented <em>but</em> what happens when our colleague gives us something like:</p>

<div class="code-block">
<div class="highlight"><pre><code class="n">determineAverage</code><code class="p">(</code><code class="mi">5</code><code class="p">,</code> <code class="mi">5</code><code class="p">,</code> <code class="mi">8</code><code class="p">,</code> <code class="err">'</code><code class="n">kitten</code><code class="err">'</code><code class="p">)</code>
</pre></div>

</div>

<p>Clearly, <em>kittens</em> aren’t something that the <em>average</em> calculation can understand<sup id="fnref-pun"><a href="chap64.html#fn-pun" rel="footnote">1</a></sup>. If you try to run that code you’ll get a nasty error that basically says your code has failed. Don’t be too hard on your colleague though - perhaps they’ve loaded data from a file that’s become corrupted by felines.</p>

<h3 id="leanpub-auto-comment-your-method">Comment your method</h3>
<p>Firstly, make sure that <code>determineAverage</code> has some useful documentation such as: </p>

<div class="code-block">
<div class="highlight"><pre><code class="cm">/**</code>
<code class="cm"> * Returns the average of the parameters</code>
<code class="cm"> *</code>
<code class="cm"> * @param values  a series of numerical values</code>
<code class="cm"> * @throws IllegalArgumentException if a parameter is a String</code>
<code class="cm"> * @returns The average of the values</code>
<code class="cm"> */</code>
<code class="n">def</code> <code class="n">determineAverage</code><code class="p">(...</code><code class="n">values</code><code class="p">)</code> 
    <code class="k">return</code> <code class="n">values</code><code class="p">.</code><code class="n">sum</code><code class="p">()</code> <code class="o">/</code> <code class="n">values</code><code class="p">.</code><code class="n">size</code><code class="p">()</code>
<code class="p">}</code>
</pre></div>

</div>

<p>In the example above I’ve just added a GroovyDoc comment block that describes what the method does, its parameter and what it will return. At the very least, other developers will see how they <em>should</em> be using my method.</p>

<h3 id="leanpub-auto-check-the-parameters">Check the parameters</h3>
<p>Next, I can be more defensive in my coding and make sure that the method has a prerequisite that needs to be met before it attempts to run.</p>

<div class="code-block">
<div class="highlight"><pre><code class="cm">/**</code>
<code class="cm"> * Returns the average of the parameters</code>
<code class="cm"> *</code>
<code class="cm"> * @param values  a series of numerical values</code>
<code class="cm"> * @throws IllegalArgumentException if a parameter is a String</code>
<code class="cm"> * @returns The average of the values</code>
<code class="cm"> */</code>
<code class="n">def</code> <code class="n">determineAverage</code><code class="p">(...</code><code class="n">values</code><code class="p">)</code> 
  <code class="n">throws</code> <code class="n">IllegalArgumentException</code> <code class="p">{</code>
    <code class="k">for</code> <code class="p">(</code><code class="n">item</code> <code class="n">in</code> <code class="n">values</code><code class="p">)</code> <code class="p">{</code>
        <code class="k">if</code> <code class="p">(</code><code class="n">item</code> <code class="n">instanceof</code> <code class="n">String</code><code class="p">)</code> <code class="p">{</code>
            <code class="n">throw</code> <code class="k">new</code> <code class="n">IllegalArgumentException</code><code class="p">()</code>
        <code class="p">}</code>
    <code class="p">}</code>
    <code class="k">return</code> <code class="n">values</code><code class="p">.</code><code class="n">sum</code><code class="p">()</code> <code class="o">/</code> <code class="n">values</code><code class="p">.</code><code class="n">size</code><code class="p">()</code>
<code class="p">}</code>

<code class="c1">//This works:</code>
<code class="k">assert</code> <code class="n">determineAverage</code><code class="p">(</code><code class="mh">12</code><code class="p">,</code> <code class="mh">18</code><code class="p">)</code> <code class="o">==</code> <code class="mh">15</code>

<code class="c1">//This does not work - we get an exception</code>
<code class="n">determineAverage</code><code class="p">(</code><code class="mh">5</code><code class="p">,</code> <code class="mh">5</code><code class="p">,</code> <code class="mh">8</code><code class="p">,</code> <code class="p">'</code><code class="n">kitten</code><code class="p">')</code>
</pre></div>

</div>

<p>The approach above checks to make sure that no parameter is a <code>String</code> - if you pass one to the method you’ll get an exception thrown back at you. In reality I should make sure that only numbers can be passed in and my check won’t pick up a <code>Boolean</code> value - more on this in a moment.</p>

<p>What do you think would happen if I called the method with no parameters - <code>determineAverage()</code>? </p>

<p>(pause)</p>

<p>Well, the division would attempt to divide by zero and that’s a fail so I need to also check that <code>values</code> isn’t empty (I’ll leave out the comments for brevity):</p>

<div class="code-block">
<div class="highlight"><pre><code class="n">def</code> <code class="nf">determineAverage</code><code class="p">(...</code><code class="n">values</code><code class="p">)</code> 
  <code class="n">throws</code> <code class="n">IllegalArgumentException</code> <code class="p">{</code>
    <code class="k">for</code> <code class="p">(</code><code class="n">item</code> <code class="n">in</code> <code class="n">values</code><code class="p">)</code> <code class="p">{</code>
        <code class="k">if</code> <code class="p">(</code><code class="n">item</code> <code class="n">instanceof</code> <code class="n">String</code><code class="p">)</code> <code class="p">{</code>
            <code class="n">throw</code> <code class="n">new</code> <code class="n">IllegalArgumentException</code><code class="p">()</code>
        <code class="p">}</code>
    <code class="p">}</code>
    
    <code class="k">if</code> <code class="p">(</code><code class="o">!</code><code class="n">values</code><code class="p">)</code> <code class="p">{</code>
        <code class="k">return</code> <code class="mi">0</code>
    <code class="p">}</code>
    
    <code class="k">return</code> <code class="n">values</code><code class="p">.</code><code class="n">sum</code><code class="p">()</code> <code class="o">/</code> <code class="n">values</code><code class="p">.</code><code class="n">size</code><code class="p">()</code>
<code class="p">}</code>
</pre></div>

</div>

<p>Note that if no parameters are passed, I return <code>0</code>. I really don’t like returning <code>null</code> from methods as it makes other developers then have to check for <code>null</code>. I also don’t want to raise an exception - I’m happy enough to say that the average of no values is <code>0</code>.</p>

<h3 id="leanpub-auto-get-really-typed">Get really typed</h3>

<p>If I really want to get specific with the data types I’ll take as parameters and return from the method then I can switch to static typing. I can make sure that all my parameters are of type <code>Number</code> (or one of its subtypes) and that I will return a value of type <code>Number</code>. The code below really gets specific about data types:</p>

<div class="code-block">
<div class="highlight"><pre><code class="cm">/**</code>
<code class="cm"> * Returns the average of the parameters</code>
<code class="cm"> *</code>
<code class="cm"> * @param values  a series of numerical values</code>
<code class="cm"> * @throws IllegalArgumentException if a parameter is a String</code>
<code class="cm"> * @returns The average of the values</code>
<code class="cm"> */</code>
<code class="n">Number</code> <code class="n">determineAverage</code><code class="p">(</code><code class="n">Number</code><code class="p">...</code><code class="n">values</code><code class="p">)</code> <code class="p">{</code>
    
    <code class="k">if</code> <code class="p">(</code><code class="o">!</code><code class="n">values</code><code class="p">)</code> <code class="p">{</code>
        <code class="k">return</code> <code class="mh">0</code> <code class="n">as</code> <code class="n">Number</code>
    <code class="p">}</code>
    
    <code class="n">Integer</code> <code class="n">sum</code> <code class="o">=</code> <code class="n">values</code><code class="p">.</code><code class="n">sum</code><code class="p">()</code> <code class="n">as</code> <code class="n">Integer</code>
    <code class="n">Integer</code> <code class="n">n</code> <code class="o">=</code> <code class="n">values</code><code class="p">.</code><code class="n">length</code>
    <code class="n">Number</code> <code class="n">average</code> <code class="o">=</code> <code class="p">(</code><code class="n">sum</code> <code class="o">/</code> <code class="n">n</code><code class="p">)</code> <code class="n">as</code> <code class="n">Number</code>
    <code class="k">return</code>  <code class="n">average</code> 
<code class="p">}</code>
</pre></div>

</div>

<p>The following two calls to the method would work:</p>

<div class="code-block">
<div class="highlight"><pre><code class="n">assert</code> <code class="n">determineAverage</code><code class="p">(</code><code class="mi">2</code><code class="p">,</code> <code class="mi">7</code><code class="p">,</code> <code class="mi">4</code><code class="p">,</code> <code class="mi">4</code><code class="p">)</code> <code class="o">==</code> <code class="mf">4.25</code>
<code class="n">assert</code> <code class="n">determineAverage</code><code class="p">()</code> <code class="o">==</code> <code class="mi">0</code>
</pre></div>

</div>

<p>…but the following two calls won’t work:</p>

<div class="code-block">
<div class="highlight"><pre><code class="n">determineAverage</code><code class="p">(</code><code class="mi">2</code><code class="p">,</code> <code class="mi">7</code><code class="p">,</code> <code class="mi">4</code><code class="p">,</code> <code class="mi">4</code><code class="p">,</code> <code class="err">'</code><code class="n">kitten</code><code class="err">'</code><code class="p">)</code>
<code class="n">determineAverage</code><code class="p">(</code><code class="mi">2</code><code class="p">,</code> <code class="mi">7</code><code class="p">,</code> <code class="mi">4</code><code class="p">,</code> <code class="mi">4</code><code class="p">,</code> <code class="nb">true</code><code class="p">)</code>
</pre></div>

</div>

<p>If you are writing a method that needs to be very specific about data types for parameters and/or return values then this is the way to go.</p>

<h3 id="leanpub-auto-testing">Testing</h3>

<p>I’d get into a lot of trouble from experienced developers if I just left this chapter without mentioning testing. I’m hoping that one day there’ll be a Testing tutorial added to this book but, until then, check out <a href="http://groovy-lang.org/testing.html">Unit Tests section</a> on the Groovy website.</p>

<p>Oh ok, here’s a little example using <a href="http://docs.spockframework.org/en/latest/">Spock</a>! </p>

<p>Firstly, this won’t run in your groovyConsole. You need to copy the code into the online <a href="http://meetspock.appspot.com">Spock web console</a><sup id="fnref-sample"><a href="chap64.html#fn-sample" rel="footnote">2</a></sup> and then click on “Run Script”:</p>

<div class="code-block">
  <p class="codeblock-title">A Spock example</p>

  <hr /><div class="highlight"><pre><code class="kn">import</code> <code class="nn">spock.lang.Specification</code>

<code class="k">class</code> <code class="nc">MathDemo</code> <code class="p">{</code>
    <code class="o">/**</code>
     <code class="o">*</code> <code class="n">Returns</code> <code class="n">the</code> <code class="n">average</code> <code class="n">of</code> <code class="n">the</code> <code class="n">parameters</code>
     <code class="o">*</code>
     <code class="o">*</code> <code class="nd">@param</code> <code class="n">values</code>  <code class="n">a</code> <code class="n">series</code> <code class="n">of</code> <code class="n">numerical</code> <code class="n">values</code>
     <code class="o">*</code> <code class="nd">@throws</code> <code class="n">IllegalArgumentException</code> <code class="k">if</code> <code class="n">a</code> <code class="n">parameter</code> <code class="ow">is</code> <code class="n">a</code> <code class="n">String</code>
     <code class="o">*</code> <code class="nd">@returns</code> <code class="n">The</code> <code class="n">average</code> <code class="n">of</code> <code class="n">the</code> <code class="n">values</code>
     <code class="o">*/</code>
    <code class="n">static</code> <code class="n">determineAverage</code><code class="p">(</code><code class="o">...</code><code class="n">values</code><code class="p">)</code> 
      <code class="n">throws</code> <code class="n">IllegalArgumentException</code> <code class="p">{</code>
        <code class="k">for</code> <code class="p">(</code><code class="n">item</code> <code class="ow">in</code> <code class="n">values</code><code class="p">)</code> <code class="p">{</code>
            <code class="k">if</code> <code class="p">(</code><code class="err">!</code> <code class="p">(</code><code class="n">item</code> <code class="n">instanceof</code> <code class="n">Number</code><code class="p">))</code> <code class="p">{</code>
                <code class="n">throw</code> <code class="n">new</code> <code class="n">IllegalArgumentException</code><code class="p">()</code>
            <code class="p">}</code>
        <code class="p">}</code>
        
        <code class="k">if</code> <code class="p">(</code><code class="err">!</code><code class="n">values</code><code class="p">)</code> <code class="p">{</code>
            <code class="k">return</code> <code class="mi">0</code>
        <code class="p">}</code>
        
        <code class="k">return</code> <code class="n">values</code><code class="o">.</code><code class="n">sum</code><code class="p">()</code> <code class="o">/</code> <code class="n">values</code><code class="o">.</code><code class="n">size</code><code class="p">()</code>
    <code class="p">}</code>
<code class="p">}</code>

<code class="k">class</code> <code class="nc">AvgSpec</code> <code class="n">extends</code> <code class="n">Specification</code> <code class="p">{</code>

    <code class="nd">@Unroll</code>
    <code class="k">def</code> <code class="err">"</code><code class="nf">average</code> <code class="n">of</code> <code class="c">#values gives #result"(values, result){</code>
        <code class="n">expect</code><code class="p">:</code>
            <code class="n">MathDemo</code><code class="o">.</code><code class="n">determineAverage</code><code class="p">(</code><code class="o">*</code><code class="n">values</code><code class="p">)</code> <code class="o">==</code> <code class="n">result</code>
        
        <code class="n">where</code><code class="p">:</code>
            <code class="n">values</code>       <code class="o">||</code> <code class="n">result</code>
            <code class="p">[</code><code class="mi">1</code><code class="p">,</code><code class="mi">2</code><code class="p">,</code><code class="mi">3</code><code class="p">]</code>      <code class="o">||</code> <code class="mi">2</code>
            <code class="p">[</code><code class="mi">2</code><code class="p">,</code> <code class="mi">7</code><code class="p">,</code> <code class="mi">4</code><code class="p">,</code> <code class="mi">4</code><code class="p">]</code> <code class="o">||</code> <code class="mf">4.25</code>
            <code class="p">[]</code>           <code class="o">||</code> <code class="mi">0</code>
    <code class="p">}</code>
    
    <code class="nd">@Unroll</code>
    <code class="k">def</code> <code class="err">"</code><code class="nf">determineAverage</code> <code class="n">called</code> <code class="k">with</code> <code class="c">#values throws #exception"(values, excepti\</code>
<code class="n">on</code><code class="p">){</code>
        <code class="n">setup</code><code class="p">:</code>
           <code class="k">def</code> <code class="nf">e</code> <code class="o">=</code> <code class="n">getException</code><code class="p">(</code><code class="n">MathDemo</code><code class="o">.&amp;</code><code class="n">determineAverage</code><code class="p">,</code> <code class="o">*</code><code class="n">values</code><code class="p">)</code>

        <code class="n">expect</code><code class="p">:</code>
            <code class="n">exception</code> <code class="o">==</code> <code class="n">e</code><code class="err">?</code><code class="o">.</code><code class="k">class</code>
        
        <code class="nc">where</code><code class="p">:</code>
            <code class="n">values</code>       <code class="o">||</code> <code class="n">exception</code>
            <code class="p">[</code><code class="s">'kitten'</code><code class="p">,</code> <code class="mi">1</code><code class="p">]</code><code class="o">||</code> <code class="n">java</code><code class="o">.</code><code class="n">lang</code><code class="o">.</code><code class="n">IllegalArgumentException</code>
            <code class="p">[</code><code class="mi">99</code><code class="p">,</code> <code class="n">true</code><code class="p">]</code>   <code class="o">||</code> <code class="n">java</code><code class="o">.</code><code class="n">lang</code><code class="o">.</code><code class="n">IllegalArgumentException</code>
            <code class="p">[</code><code class="mi">1</code><code class="p">,</code><code class="mi">2</code><code class="p">,</code><code class="mi">3</code><code class="p">]</code>      <code class="o">||</code> <code class="n">null</code>
    <code class="p">}</code>
    
    <code class="ne">Exception</code> <code class="n">getException</code><code class="p">(</code><code class="n">closure</code><code class="p">,</code> <code class="o">...</code><code class="n">args</code><code class="p">){</code>
        <code class="k">try</code><code class="p">{</code>
            <code class="n">closure</code><code class="o">.</code><code class="n">call</code><code class="p">(</code><code class="n">args</code><code class="p">)</code>
            <code class="k">return</code> <code class="n">null</code>
        <code class="p">}</code> <code class="n">catch</code><code class="p">(</code><code class="nb">any</code><code class="p">)</code> <code class="p">{</code>
            <code class="k">return</code> <code class="nb">any</code>
        <code class="p">}</code>
    <code class="p">}</code>
<code class="p">}</code>
</pre></div>

  <hr /></div>

<p>When you run this in the Spock web console you should get:</p>

<div class="code-block">
<div class="highlight"><pre><code class="n">AvgSpec</code>
 <code class="o">-</code> <code class="n">average</code> <code class="n">of</code> <code class="p">[</code><code class="mi">1</code><code class="p">,</code> <code class="mi">2</code><code class="p">,</code> <code class="mi">3</code><code class="p">]</code> <code class="n">gives</code> <code class="mi">2</code>
 <code class="o">-</code> <code class="n">average</code> <code class="n">of</code> <code class="p">[</code><code class="mi">2</code><code class="p">,</code> <code class="mi">7</code><code class="p">,</code> <code class="mi">4</code><code class="p">,</code> <code class="mi">4</code><code class="p">]</code> <code class="n">gives</code> <code class="mf">4.25</code>
 <code class="o">-</code> <code class="n">average</code> <code class="n">of</code> <code class="p">[]</code> <code class="n">gives</code> <code class="mi">0</code>
 <code class="o">-</code> <code class="n">determineAverage</code> <code class="n">called</code> <code class="n">with</code> <code class="p">[</code><code class="n">kitten</code><code class="p">,</code> <code class="mi">1</code><code class="p">]</code> <code class="n">throws</code> <code class="n">class</code> <code class="n">java</code><code class="p">.</code><code class="n">lang</code><code class="p">.</code><code class="n">IllegalArgume</code>\
<code class="n">ntException</code>
 <code class="o">-</code> <code class="n">determineAverage</code> <code class="n">called</code> <code class="n">with</code> <code class="p">[</code><code class="mi">99</code><code class="p">,</code> <code class="nb">true</code><code class="p">]</code> <code class="n">throws</code> <code class="n">class</code> <code class="n">java</code><code class="p">.</code><code class="n">lang</code><code class="p">.</code><code class="n">IllegalArgumen</code>\
<code class="n">tException</code>
 <code class="o">-</code> <code class="n">determineAverage</code> <code class="n">called</code> <code class="n">with</code> <code class="p">[</code><code class="mi">1</code><code class="p">,</code> <code class="mi">2</code><code class="p">,</code> <code class="mi">3</code><code class="p">]</code> <code class="n">throws</code> <code class="n">null</code>
</pre></div>

</div>

<p>So there’s a lot going on here that we haven’t covered in the tutorials so far but let’s try to break it down:</p>

<ol class="numeric"><li>I wrapped the <code>determineAverage()</code> method in a class named <code>MathDemo</code> and made it a <code>static</code> method
    <ul><li>I won’t explain this here - just trust me that you can call <code>MathDemo.determineAverage()</code></li>
      <li>But do note that I’ve changed <code>determineAverage()</code> to better check that the parameters are numbers.</li>
    </ul></li>
  <li>I then created a spock test <code>Specification</code> subclass called <code>AvgSpec</code>
    <ol class="numeric"><li>The first test is <code>def "average of #values gives #result"(values, result)</code>
        <ol class="numeric"><li>This runs a series of tests using the data table in the <code>where:</code> block</li>
          <li>Yes, that’s right, Groovy will let you use a string as the name of the method - that’s v.cool but you can’t use interpolation (<code>${}</code>).</li>
        </ol></li>
      <li>The second test is <code>def "determineAverage called with #values throws #exception"(values, exception)</code>
        <ol class="numeric"><li>This checks to make sure that the <code>IllegalArgumentException</code> is thrown for incorrect parameters</li>
        </ol></li>
    </ol></li>
</ol><p>As I say, there are a number of topics such as classes and closures that I haven’t covered - this example was just a quick one and should make sense as you learn about those additional concepts.</p>

<!-- begin backmatter -->
<div class="footnotes">
  <ol><li id="fn-pun">Pun intended<a href="chap64.html#fnref-pun" rev="footnote">↩</a></li>
    <li id="fn-sample">I’ve <a href="http://meetspock.appspot.com/script/5713144022302720">published the code</a> to make it easy for you but can’t promise that this link will always work.<a href="chap64.html#fnref-sample" rev="footnote">↩</a></li>
  </ol></div>
</div>
</body>
</html>
